@model BestieToy.ViewModels.RegisterViewModel

@{
    ViewData["Title"] = "Đăng ký tài khoản";
}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-7">
            <div class="card border-0 shadow-lg">
                <div class="card-body p-5">
                    <!-- Logo & Title -->
                    <div class="text-center mb-4">
                        <div class="logo-icon mx-auto mb-3">
                            <i class="fas fa-paw"></i>
                        </div>
                        <h2 class="h4">Tạo tài khoản mới</h2>
                        <p class="text-muted">Đăng ký để nhận nhiều ưu đãi hấp dẫn</p>
                    </div>

                    <!-- Registration Form -->
                    <form asp-controller="Auth" asp-action="Register" method="post">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                        <div class="row g-3">
                            <!-- Username -->
                            <div class="col-md-6">
                                <label asp-for="Username" class="form-label">Tên đăng nhập *</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-user"></i>
                                    </span>
                                    <input asp-for="Username" class="form-control"
                                           placeholder="Từ 3-100 ký tự">
                                </div>
                                <span asp-validation-for="Username" class="text-danger small"></span>
                            </div>

                            <!-- Email -->
                            <div class="col-md-6">
                                <label asp-for="Email" class="form-label">Email *</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-envelope"></i>
                                    </span>
                                    <input asp-for="Email" type="email" class="form-control"
                                           placeholder="example@email.com">
                                </div>
                                <span asp-validation-for="Email" class="text-danger small"></span>
                            </div>

                            <!-- Full Name -->
                            <div class="col-md-6">
                                <label asp-for="FullName" class="form-label">Họ tên *</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-id-card"></i>
                                    </span>
                                    <input asp-for="FullName" class="form-control"
                                           placeholder="Nguyễn Văn A">
                                </div>
                                <span asp-validation-for="FullName" class="text-danger small"></span>
                            </div>

                            <!-- Phone -->
                            <div class="col-md-6">
                                <label asp-for="Phone" class="form-label">Số điện thoại</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-phone"></i>
                                    </span>
                                    <input asp-for="Phone" class="form-control"
                                           placeholder="0912345678">
                                </div>
                                <span asp-validation-for="Phone" class="text-danger small"></span>
                            </div>

                            <!-- Address -->
                            <div class="col-12">
                                <label asp-for="Address" class="form-label">Địa chỉ</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-home"></i>
                                    </span>
                                    <input asp-for="Address" class="form-control"
                                           placeholder="Số nhà, đường, phường/xã, quận/huyện, thành phố">
                                </div>
                                <span asp-validation-for="Address" class="text-danger small"></span>
                            </div>

                            <!-- Password -->
                            <div class="col-md-6">
                                <label asp-for="Password" class="form-label">Mật khẩu *</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-lock"></i>
                                    </span>
                                    <input asp-for="Password" type="password" class="form-control"
                                           placeholder="Từ 6-100 ký tự">
                                    <button type="button" class="btn btn-outline-secondary toggle-password">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <span asp-validation-for="Password" class="text-danger small"></span>
                                <div class="form-text">
                                    <small>Mật khẩu phải có ít nhất 6 ký tự</small>
                                </div>
                            </div>

                            <!-- Confirm Password -->
                            <div class="col-md-6">
                                <label asp-for="ConfirmPassword" class="form-label">Xác nhận mật khẩu *</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-lock"></i>
                                    </span>
                                    <input asp-for="ConfirmPassword" type="password" class="form-control"
                                           placeholder="Nhập lại mật khẩu">
                                    <button type="button" class="btn btn-outline-secondary toggle-password">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- Terms Agreement -->
                        <div class="form-check my-4">
                            <input type="checkbox" class="form-check-input" id="agreeTerms" required>
                            <label class="form-check-label" for="agreeTerms">
                                Tôi đồng ý với
                                <a href="#" class="text-decoration-none">Điều khoản sử dụng</a> và
                                <a href="#" class="text-decoration-none">Chính sách bảo mật</a>
                            </label>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary btn-lg w-100 mb-3">
                            <i class="fas fa-user-plus me-2"></i>Đăng ký tài khoản
                        </button>

                        <!-- Login Link -->
                        <div class="text-center">
                            <p class="mb-0">
                                Đã có tài khoản?
                                <a asp-controller="Auth" asp-action="Login" class="text-decoration-none fw-semibold">
                                    Đăng nhập ngay
                                </a>
                            </p>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Registration Benefits -->
            <div class="row mt-4 g-3">
                <div class="col-md-4">
                    <div class="text-center p-3 bg-light rounded">
                        <i class="fas fa-gift fa-2x text-primary mb-2"></i>
                        <h6 class="mb-1">Ưu đãi thành viên</h6>
                        <p class="small text-muted mb-0">Giảm giá cho lần mua đầu</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center p-3 bg-light rounded">
                        <i class="fas fa-shipping-fast fa-2x text-primary mb-2"></i>
                        <h6 class="mb-1">Miễn phí vận chuyển</h6>
                        <p class="small text-muted mb-0">Cho đơn hàng từ 500K</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center p-3 bg-light rounded">
                        <i class="fas fa-history fa-2x text-primary mb-2"></i>
                        <h6 class="mb-1">Theo dõi đơn hàng</h6>
                        <p class="small text-muted mb-0">Quản lý đơn hàng dễ dàng</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .logo-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
    }

    .card {
        border-radius: var(--radius-xl);
    }

    .input-group-text {
        background-color: #f8f9fa;
        border-right: none;
    }

    .input-group .form-control {
        border-left: none;
    }

    .form-check-input:checked {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }

    .form-check-label a {
        color: var(--primary-color);
    }

    .bg-light {
        background-color: #f8f9fa !important;
    }
</style>

@section Scripts {
    <script>
        // Toggle password visibility
        $('.toggle-password').on('click', function() {
            var input = $(this).closest('.input-group').find('input');
            var icon = $(this).find('i');

            if (input.attr('type') === 'password') {
                input.attr('type', 'text');
                icon.removeClass('fa-eye').addClass('fa-eye-slash');
            } else {
                input.attr('type', 'password');
                icon.removeClass('fa-eye-slash').addClass('fa-eye');
            }
        });

        // Password strength indicator
        $('#Password').on('keyup', function() {
            var password = $(this).val();
            var strength = 0;

            if (password.length >= 6) strength++;
            if (password.match(/[a-z]/)) strength++;
            if (password.match(/[A-Z]/)) strength++;
            if (password.match(/[0-9]/)) strength++;
            if (password.match(/[^a-zA-Z0-9]/)) strength++;

            // Update visual indicator
            var strengthText = ['Rất yếu', 'Yếu', 'Trung bình', 'Mạnh', 'Rất mạnh'];
            var strengthColor = ['danger', 'warning', 'info', 'primary', 'success'];

            if (password.length > 0) {
                $('#password-strength').removeClass('d-none').find('.progress-bar')
                    .css('width', (strength * 20) + '%')
                    .removeClass('bg-danger bg-warning bg-info bg-primary bg-success')
                    .addClass('bg-' + strengthColor[strength - 1])
                    .text(strengthText[strength - 1]);
            } else {
                $('#password-strength').addClass('d-none');
            }
        });

        // Confirm password validation
        $('#ConfirmPassword').on('keyup', function() {
            var password = $('#Password').val();
            var confirm = $(this).val();

            if (confirm && password !== confirm) {
                $(this).addClass('is-invalid').removeClass('is-valid');
                $('#confirm-feedback').removeClass('d-none').text('Mật khẩu không khớp');
            } else if (confirm && password === confirm) {
                $(this).removeClass('is-invalid').addClass('is-valid');
                $('#confirm-feedback').addClass('d-none');
            } else {
                $(this).removeClass('is-invalid is-valid');
                $('#confirm-feedback').addClass('d-none');
            }
        });

        // Form validation
        $('form').on('submit', function(e) {
            if (!$('#agreeTerms').is(':checked')) {
                e.preventDefault();
                showToast('Vui lòng đồng ý với điều khoản sử dụng', 'error');
                return false;
            }

            var password = $('#Password').val();
            var confirm = $('#ConfirmPassword').val();

            if (password !== confirm) {
                e.preventDefault();
                showToast('Mật khẩu xác nhận không khớp', 'error');
                return false;
            }
        });
    </script>

    <!-- Add password strength indicator HTML -->
    <div id="password-strength" class="mt-2 d-none">
        <div class="d-flex justify-content-between mb-1">
            <small>Độ mạnh mật khẩu:</small>
            <small class="password-strength-text"></small>
        </div>
        <div class="progress" style="height: 5px;">
            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
        </div>
    </div>
}